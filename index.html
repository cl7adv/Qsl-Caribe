<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estaci√≥n Digital ZMR - CL7ADV</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        :root {
            --primary: #00eaff; /* Celeste Ne√≥n */
            --accent: #ff00ff;  /* Rosa Ne√≥n */
            --cuba-red: #d40000;
            --cuba-blue: #002a8f;
            --glass: rgba(10, 25, 35, 0.95);
        }

        body { 
            margin: 0; font-family: 'Segoe UI', sans-serif; 
            background: #000 url('https://i.postimg.cc/k47vQh5X/qsl-caribena-neon-noche-final.jpg') no-repeat center center fixed;
            background-size: cover; color: #fff;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        /* Men√∫ de Ventanas */
        .nav-tabs {
            margin-top: 20px; display: flex; gap: 10px; z-index: 10;
        }

        .tab-btn {
            padding: 12px 25px; border: 2px solid var(--primary); background: var(--glass);
            color: var(--primary); cursor: pointer; border-radius: 10px 10px 0 0;
            font-weight: bold; transition: 0.3s; text-transform: uppercase;
        }

        .tab-btn.active {
            background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary);
        }

        /* Contenedor Principal */
        .main-panel {
            width: 90%; max-width: 700px; background: var(--glass);
            border: 2px solid var(--primary); border-radius: 0 20px 20px 20px;
            padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            backdrop-filter: blur(10px); position: relative;
        }

        .view { display: none; text-align: center; animation: fadeIn 0.5s; }
        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Estilos Buscador */
        h1 { font-size: 1.8rem; text-shadow: 0 0 10px var(--primary); margin-bottom: 5px; }
        .subtitle { color: #ff9800; font-size: 0.8rem; margin-bottom: 25px; letter-spacing: 2px; }

        input {
            padding: 15px; width: 60%; border-radius: 10px; border: 2px solid #333;
            background: #000; color: var(--primary); font-size: 1.2rem; text-align: center;
        }

        .btn-action {
            padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer;
            font-weight: bold; margin-top: 10px; background: var(--primary); color: #000;
        }

        /* Estilos Morse */
        .visualizer { width: 100%; height: 80px; background: #000; margin: 15px 0; border-radius: 5px; border: 1px solid var(--accent); }
        .morse-output { 
            font-size: 2rem; color: var(--accent); min-height: 80px; 
            background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; border: 1px solid #333;
        }

        /* Barra de Carga */
        .progress-container { width: 80%; height: 8px; background: #222; margin: 20px auto; border-radius: 10px; display: none; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; box-shadow: 0 0 10px var(--primary); }

        footer { margin-top: 30px; font-size: 0.8rem; opacity: 0.6; }
    </style>
</head>
<body>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('qsl-view', this)">üìÅ Buscador QSL</button>
        <button class="tab-btn" onclick="switchTab('morse-view', this)">üì° Escucha Morse</button>
    </div>

    <div class="main-panel">
        
        <div id="qsl-view" class="view active">
            <h1>üå¥ QSL CARIBE√ëA</h1>
            <p class="subtitle">RADIO CLUB SANTA CRUZ DEL SUR - CUBA</p>
            
            <input type="text" id="callsign" placeholder="INDICATIVO" maxlength="10">
            <br>
            <button class="btn-action" onclick="buscarQSL()">SINTONIZAR QSL</button>

            <div class="progress-container" id="pContainer">
                <div class="progress-fill" id="pFill"></div>
            </div>
            <div id="qslStatus" style="margin-top:10px; color:var(--primary); font-weight:bold;"></div>
            <div id="qslResult"></div>
        </div>

        <div id="morse-view" class="view">
            <h1>üìª DECODIFICADOR CW</h1>
            <p class="subtitle">SINTON√çA POR MICR√ìFONO (AMATEUR RADIO)</p>
            
            <button class="btn-action" id="startMic" style="background:var(--accent)">ACTIVAR ESCUCHA</button>
            <canvas id="visualizer" class="visualizer"></canvas>
            
            <div id="morseCode" style="color:var(--primary); font-size:1.2rem; height:20px;"></div>
            <div class="morse-output" id="textOutput">...</div>
            
            <button class="btn-action" onclick="document.getElementById('textOutput').innerText='...'" style="background:#444; color:#fff; font-size:0.7rem;">BORRAR TEXTO</button>
        </div>

        <footer>
            CL7ADV &bull; Alfred &bull; Santa Cruz del Sur &bull; 2026
        </footer>
    </div>

    <script>
        // --- L√ìGICA DE NAVEGACI√ìN ---
        function switchTab(viewId, btn) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            btn.classList.add('active');
        }

        // --- L√ìGICA BUSCADOR QSL ---
        function buscarQSL() {
            const call = document.getElementById('callsign').value.trim().toUpperCase();
            if(!call) return;

            const pFill = document.getElementById('pFill');
            const pBox = document.getElementById('pContainer');
            const status = document.getElementById('qslStatus');
            const res = document.getElementById('qslResult');

            res.innerHTML = "";
            pBox.style.display = "block";
            status.innerText = "SINTONIZANDO SE√ëAL...";

            let p = 0;
            const anim = setInterval(() => {
                p += 5;
                pFill.style.width = p + "%";
                if(p == 50) status.innerText = "BUSCANDO EN BASE DE DATOS...";
                if(p >= 100) {
                    clearInterval(anim);
                    status.innerText = "";
                    pBox.style.display = "none";
                    res.innerHTML = `<div style="color:#ff6b6b; border:1px solid #ff6b6b; padding:10px; margin-top:20px; border-radius:10px;">‚ö†Ô∏è QSL NO ENCONTRADA PARA ${call}</div>`;
                    setTimeout(() => { res.innerHTML = ""; }, 10000); // 10s Reset
                }
            }, 50);
        }

        // --- L√ìGICA DECODIFICADOR MORSE ---
        const morseDoc = {'.-':'A','-...':'B','-.-.':'C','-..':'D','.':'E','..-.':'F','--.':'G','....':'H','..':'I','.---':'J','-.-':'K','.-..':'L','--':'M','-.':'N','---':'O','.--.':'P','--.-':'Q','.-.':'R','...':'S','-':'T','..-':'U','...-':'V','.--':'W','-..-':'X','-.--':'Y','--..':'Z','-----':'0','.----':'1','..---':'2','...--':'3','....-':'4','.....':'5','-....':'6','--...':'7','---..':'8','----.':'9'};
        
        let audioCtx, analyser, currentMorse = "", startTime = 0, silenceTime = Date.now();
        const startBtn = document.getElementById('startMic');

        startBtn.onclick = async () => {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const source = audioCtx.createMediaStreamSource(stream);
            analyser = audioCtx.createAnalyser();
            source.connect(analyser);
            startBtn.innerText = "üéôÔ∏è ESCUCHANDO...";
            startBtn.disabled = true;
            processAudio();
        };

        function processAudio() {
            const data = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(data);
            const vol = data.reduce((a, b) => a + b) / data.length;
            const now = Date.now();

            if (vol > 45) { // Umbral de sonido
                if (startTime === 0) startTime = now;
                silenceTime = 0;
            } else {
                if (startTime !== 0) {
                    let d = now - startTime;
                    currentMorse += (d < 250) ? "." : "-";
                    document.getElementById('morseCode').innerText = currentMorse;
                    startTime = 0;
                    silenceTime = now;
                }
                if (silenceTime !== 0 && now - silenceTime > 800 && currentMorse !== "") {
                    let char = morseDoc[currentMorse] || "?";
                    const out = document.getElementById('textOutput');
                    if(out.innerText === "...") out.innerText = "";
                    out.innerText += char;
                    currentMorse = "";
                    document.getElementById('morseCode').innerText = "";
                }
            }
            requestAnimationFrame(processAudio);
        }
    </script>
</body>
</html>
